<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Buffers &amp; Convex Hulls" />
<meta property="og:description" content="--- author: Rodney J. Dyer date: 2016-03-18 layout: post title: Buffers & Convex Hulls categories: - Code - gdistance - polygon - R - raster - Tutorials --- An analysis common to modern population genetics is that of finding ecological distances between objects on a landscape. The estimation of pairwise distance derived from spatial data is a computationally intensive thing, one that if you are not careful will bring your laptop to its knees!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://dyerlab/2016/03/buffers--convex-hulls/" />


<meta property="og:updated_time" content="2016-03-18T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Buffers &amp; Convex Hulls">
<meta itemprop="description" content="--- author: Rodney J. Dyer date: 2016-03-18 layout: post title: Buffers & Convex Hulls categories: - Code - gdistance - polygon - R - raster - Tutorials --- An analysis common to modern population genetics is that of finding ecological distances between objects on a landscape. The estimation of pairwise distance derived from spatial data is a computationally intensive thing, one that if you are not careful will bring your laptop to its knees!">


<meta itemprop="dateModified" content="2016-03-18T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="763">



<meta itemprop="keywords" content="2gener,aflp,applied-population-genetics,araptus-attenuata,baja-california,blog,ces,cgd,code,default-calendar,documents,dogwood,dyerlab,edna,fitness,gdistance,gene-flow,genetic-structure,genomics,ggplot2,google,google-docs,graduate,gsl,gstudio,laboratory,landscape-genetics,lophocereus-schottii,main-menu,manuscripts,maps,markers,null-alleles,ole2015,online,online-publishing,paternity,people,phylogeography,polygon,popgraph,population-genetics,population-graphs,presentations,projects,protocols,publications,r,raster,reproducible-research,research,rstudio,servers,slack,software,spatial,stamova,sturgeon,sustainability,teaching,theory,tutorial,tutorials,uncategorized,unix,urbanization,vcu,vcugenetics2015,xcode," />



  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="Buffers &amp; Convex Hulls"/>
<meta name="twitter:description" content="--- author: Rodney J. Dyer date: 2016-03-18 layout: post title: Buffers & Convex Hulls categories: - Code - gdistance - polygon - R - raster - Tutorials --- An analysis common to modern population genetics is that of finding ecological distances between objects on a landscape. The estimation of pairwise distance derived from spatial data is a computationally intensive thing, one that if you are not careful will bring your laptop to its knees!"/>
<meta name="twitter:site" content="@dyerlab"/>









<meta name="generator" content="Hugo 0.18.1" />


    <link rel="canonical" href="http://dyerlab/2016/03/buffers--convex-hulls/">

    <title>Buffers &amp; Convex Hulls | The Dyer Laboratory</title>

    <!-- combined, minified CSS -->
    <link href="http://dyerlab/css/style.css" rel="stylesheet" integrity="sha384-qRVpIj9hSzsBhmO8Y7YEKF2UFra2sJQtl9V/uFKKDvy&#43;Wjh9zgTku6VRgT8YdPoD" crossorigin="anonymous">

    

    

    

    
<link rel="stylesheet" href="/css/dyerlab.css">
<script>
  (function() {
    var cx = '005624429758912894427:ewy8fmekoli';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>




  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="http://dyerlab/">Home</a>
          
          
          <a class="nav-link" href="http://dyerlab/people/">People</a>
          
          <a class="nav-link" href="http://dyerlab/publications/">Publications</a>
          
          <a class="nav-link" href="http://dyerlab/texts/">Texts</a>
          
          
        </nav>
      </div>
    </div>

    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="http://dyerlab/" rel="home">The Dyer Laboratory</a></h1>
        <p class="lead blog-description">Illuminating the mechanics of genetic connectivity.</p>
      </div>
    </header>

    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="http://dyerlab/2016/03/buffers--convex-hulls/">Buffers &amp; Convex Hulls</a></h2>
    <p class="blog-post-meta"><time datetime="2016-03-18T00:00:00Z">Fri Mar 18, 2016</time> by Rodney J. Dyer in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/code" rel="category tag">Code</a>, <a href="/categories/gdistance" rel="category tag">gdistance</a>, <a href="/categories/polygon" rel="category tag">polygon</a>, <a href="/categories/r" rel="category tag">R</a>, <a href="/categories/raster" rel="category tag">raster</a>, <a href="/categories/tutorials" rel="category tag">Tutorials</a>


</p>
  </header>
  ---
author: Rodney J. Dyer
date: 2016-03-18
layout: post
title: Buffers & Convex Hulls
categories: 
- Code
- gdistance
- polygon
- R
- raster
- Tutorials
---




<p>An analysis common to modern population genetics is that of finding ecological distances between objects on a landscape. The estimation of pairwise distance derived from spatial data is a computationally intensive thing, one that if you are not careful will bring your laptop to its knees! One way to mitigate this data problem is to use a minimal amount raster area so that the estimation of the underlying distance graph can be done on a smaller set of points. This example provides a simple solution using convex hulls. ## A Bounding Box Approach The first option is to create a bounding box around your points. For this, I’ll use the enigmatic arapat data set included in the gstudio package.</p>
<pre class="r"><code>library(raster)
library(gstudio)
data(arapat)
lon.min &lt;- min(arapat$Longitude)
lon.max &lt;- max(arapat$Longitude)
lat.min &lt;- min(arapat$Latitude)
lat.max &lt;- max(arapat$Latitude)
e &lt;- extent( lon.min, lon.max, lat.min, lat.max )
e</code></pre>
<pre><code>## class       : Extent 
## xmin        : -114.2935 
## xmax        : -109.1263 
## ymin        : 23.0757 
## ymax        : 29.32541</code></pre>
<p>This is the minimal box around the points, but we probably want to have some kind of buffer as we don’t want our populations on the very edge of the raster.</p>
<pre class="r"><code>e &lt;- extent( -115, -108, 23, 30 )
e</code></pre>
<pre><code>## class       : Extent 
## xmin        : -115 
## xmax        : -108 
## ymin        : 23 
## ymax        : 30</code></pre>
<p>Now we can crop the raster to this size. I’ll use the altitude tile 22 from <a href="http://worldclim.org">worldclim</a> for this. Here is the original raster.</p>
<pre class="r"><code>alt &lt;- raster(&quot;../../data/alt_22.tif&quot;)
alt</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 3600, 3600, 12960000  (nrow, ncol, ncell)
## resolution  : 0.008333333, 0.008333333  (x, y)
## extent      : -120, -90, 0, 30  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/rodney/Desktop/dyerlabweb/data/alt_22.tif 
## names       : alt_22 
## values      : -202, 5469  (min, max)</code></pre>
<p>which looks like.</p>
<pre class="r"><code>plot(alt)</code></pre>
<p><img src="figures/unnamed-chunk-4-1.png" width="672" /> We can crop it to the bounding box for the points as:</p>
<pre class="r"><code>bc &lt;- crop( alt, e )
bc</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 840, 840, 705600  (nrow, ncol, ncell)
## resolution  : 0.008333333, 0.008333333  (x, y)
## extent      : -115, -108, 23, 30  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : alt_22 
## values      : -202, 2774  (min, max)</code></pre>
<pre class="r"><code>coords &lt;- strata_coordinates(arapat)
pts &lt;- SpatialPoints( coords[,2:3] )
plot(bc, xlab=&quot;Longitude&quot;, ylab=&quot;Latitude&quot;)
points( pts, col=&quot;darkred&quot;, pch=16)</code></pre>
<p><img src="figures/unnamed-chunk-6-1.png" width="672" /> ## A Convex Hull Approach As you look at the image above, you see that there is a lot of area that is not in ‘the midst’ of the points. Moreover, there are those points on the mainland who are probably not going to be connected to the peninsular points due to the Sea of Cortez.  I’m going to first limit the points to the ones on the peninsula and then we will estimate a convex hull. A convex hull is the small convex polygon that contains all the points. You can think of it like snapping a rubber band around the points.  This will give us the minimal raster area on which can estimate raster-based distances (though we probably want to put a buffer around it so that we do not have points at the very edge). Here is how we do that. First, I’ll extract just the peninsular populations.</p>
<pre class="r"><code>baja_coords &lt;- coords[ !(coords$Stratum %in% c(&quot;101&quot;,&quot;102&quot;,&quot;32&quot;)), ]
baja_pts &lt;- SpatialPoints( baja_coords[,2:3])
plot(bc)
plot(baja_pts,add=T,col=&quot;darkred&quot;)
plot(baja_pts,add=T,col=&quot;darkred&quot;,pch=16)</code></pre>
<p><img src="figures/unnamed-chunk-7-1.png" width="672" /> Then we will load in the rgeos library and determine the hull</p>
<pre class="r"><code>require(rgeos)
hull &lt;- gConvexHull(baja_pts)
plot(bc)
plot(baja_pts,add=T,col=&quot;darkred&quot;)
plot(baja_pts,add=T,col=&quot;darkred&quot;,pch=16)
plot(hull,add=T,border=&quot;green&quot;)</code></pre>
<p><img src="figures/unnamed-chunk-8-1.png" width="672" /> This is great! So now, we probably want to put a buffer around it so that the points are on the very edge. The units we will use depend upon the units of the raster. So in this case, it will be in degrees of lat/lon (which is a bit dodgy since they are not quite equal distance metrics but for our purposes it is just fine).</p>
<pre class="r"><code>hull_plus_buffer &lt;- gBuffer(hull,width=.2)
plot(bc)
plot(baja_pts,add=T,col=&quot;darkred&quot;)
plot(baja_pts,add=T,col=&quot;darkred&quot;,pch=16)
plot(hull_plus_buffer, add=T, border=&quot;red&quot;)</code></pre>
<p><img src="figures/unnamed-chunk-9-1.png" width="672" /> Perfect! Now, we need to only keep those components of our raster that are within the hull_plus_buffer polygon, and for this we use a mask.</p>
<pre class="r"><code>pop_hull &lt;- mask(bc,hull_plus_buffer)
plot(pop_hull)
plot(baja_pts,add=T,col=&quot;darkred&quot;,pch=16)</code></pre>
<p><img src="figures/unnamed-chunk-10-1.png" width="672" /> Exact! Now, when you run this raster and these points through gdistance, you will be using a more minimal set of raster data for the calculations and it will be more efficient—and reduce the thermal load you are imposing on your laptop!</p>




  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdyerlab%2f2016%2f03%2fbuffers--convex-hulls%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=http%3a%2f%2fdyerlab%2f2016%2f03%2fbuffers--convex-hulls%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      
      <a class="nav-item" href="https://twitter.com/home?status=http%3a%2f%2fdyerlab%2f2016%2f03%2fbuffers--convex-hulls%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 offset-sm-1 blog-sidebar">
  
  
  

  <section class="sidebar-module  sidebar-module-inset">
    <h4>Recent Posts</h4>
    <ol class="list-unstyled">
      
      <li><a href="/2017/01/new-server-new-site-first-post/">New Server, New Site, First Post!</a></li>
      
      <li><a href="/2017/01/new-position/">New Position</a></li>
      
      <li><a href="/2016/12/life-sciences-graduation/">Life Sciences Graduation</a></li>
      
      <li><a href="/2016/11/talk-at-temple/">Talk at Temple!</a></li>
      
      <li><a href="/2016/10/spatial-data-sources/">Spatial Data Sources</a></li>
      
    </ol>
  </section>

  
  
  <section class="sidebar-module sidebar-module-inset">
  <h5>Search Dyerlab</h5>
  <gcse:searchbox-only></gcse:searchbox-only>
  </section>
  
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="http://dyerlab.com/categories">Blog Tags</a></li>
      
      <li><a href="http://dyerlab.com/rstudio">RStudio</a></li>
      
      <li><a href="https://github.com/dyerlab">Github</a></li>
      
    </ol>
  </section>
  
  
  <div class="twitter-timeline">
    <a class="twitter-timeline" href="https://twitter.com/Dyerlab" data-height="1200">Tweets by Dyerlab</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="blog-footer">
      <p>
      
      &copy; by 2017 <a href="mailto:rjdyer@vcu.edu">R.J. Dyer</a>.
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>

  </body>

</html>
